#pragma once
///////////////////////////////////////////////////////////////////////////////
// Project-wide includes, configuration, and constants.
///////////////////////////////////////////////////////////////////////////////

#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include "pico/stdlib.h"
#include "pico/multicore.h"
#include "hardware/clocks.h"
#include "hardware/irq.h"
#include "hardware/sync.h"
#include "hardware/gpio.h"
#include "hardware/vreg.h"
#include "hardware/structs/bus_ctrl.h"
#include "hardware/dma.h"
#include "pico/sem.h"

#include "dvi.h"
#include "dvi_serialiser.h"
#include "common_dvi_pin_configs.h"
#include "tmds_encode_font_2bpp.h"
#include "commands.h"

// ----------------------------------------------------------------------------
// Defines
// ----------------------------------------------------------------------------

#define LED_PIN 	7

// Host bus interface, PIO defs. 
#define GPIO_BASE   		    20
#define NUM_PINS    		    10
#define SM          		    0
#define DEFAULT_PIO 		    pio0
#define DEFAULT_PIO_IRQ_0 	PIO0_IRQ_0
#define DEFAULT_IRQ_SOURCE 	pis_interrupt0

#define HOST_FIFO_SZ 		512  // buffers bytes from host for processing
// Pick a video mode:
#define   MODE_640x480_60Hz
// #define MODE_720x480_60Hz
// #define MODE_800x600_60Hz
// #define MODE_960x540p_60Hz
// #define MODE_1280x720_30Hz

// text mode defaults
#define   TEXT_COLOR_DEFAULT_BG   0b010000    // rgb222 (dark red)
#define   TEXT_COLOR_DEFAULT_FG   0b111000    // rgb222 (amber)

#define   TEXT_CURS_DEFAULT_BLINKPD   16    // 60ths secs per toggle
#define   TEXT_DEFAULT_TAB_SZ         4


#if defined(MODE_640x480_60Hz)
#define   FRAME_WIDTH   640
#define   FRAME_HEIGHT  480
#define   VREG_VSEL     VREG_VOLTAGE_1_20
#define   DVI_TIMING    dvi_timing_640x480p_60hz
#elif defined(MODE_720x480_60Hz)
#define   FRAME_WIDTH   720
#define   FRAME_HEIGHT  480
#define   VREG_VSEL     VREG_VOLTAGE_1_20
#define   DVI_TIMING    dvi_timing_720x480p_60hz
#elif defined(MODE_800x600_60Hz)
#define   FRAME_WIDTH   800
#define   FRAME_HEIGHT  600
#define   VREG_VSEL     VREG_VOLTAGE_1_30
#define   DVI_TIMING    dvi_timing_800x600p_60hz
#elif defined(MODE_960x540p_60Hz)
#define   FRAME_WIDTH   960
#define   FRAME_HEIGHT  540
#define   VREG_VSEL     VREG_VOLTAGE_1_25
#define   DVI_TIMING    dvi_timing_960x540p_60hz
#elif defined(MODE_1280x720_30Hz)
#define   FRAME_WIDTH   1280
#define   FRAME_HEIGHT  720
#define   VREG_VSEL     VREG_VOLTAGE_1_25
#define   DVI_TIMING    dvi_timing_1280x720p_30hz
#else
#error "Select a video mode!"
#endif

// defined in main.c, used all over, but I dont want to have a main.h
extern struct dvi_inst dvi0;

// Power-on default palette (see conf.py, sonic_pug_palette_512.png)

static const uint16_t default_palette[512] = {
  0x7fff,0x77bd,0x739c,0x6f7b,0x6b5a,0x6739,0x6318,0x5ef7,0x5ad6,0x56b5,0x5294,0x4e73,0x4a52,0x4631,0x4210,0x3def,
  0x39ce,0x35ad,0x318c,0x2d6b,0x294a,0x2529,0x2108,0x1ce7,0x18c6,0x14a5,0x1084,0x0c63,0x0842,0x0421,0x0000,0x0000,
  0x7def,0x7d6b,0x7ce7,0x7c00,0x7400,0x6c00,0x6400,0x5c00,0x5400,0x4c00,0x4400,0x3c00,0x3400,0x2c00,0x2000,0x1800,
  0x7f57,0x7f12,0x7ece,0x7e8a,0x7e46,0x7e03,0x7dc0,0x7180,0x6960,0x6540,0x5d20,0x5900,0x4cc0,0x4080,0x3c60,0x3840,
  0x734a,0x6ac8,0x5e45,0x55c3,0x4962,0x4100,0x3880,0x2800,0x7fe9,0x7fe0,0x6f41,0x62c1,0x5241,0x41c1,0x3560,0x2900,
  0x7ff9,0x7ff5,0x7ff1,0x7fed,0x734f,0x66ef,0x5a8e,0x49eb,0x6bf4,0x6371,0x570f,0x4aad,0x3e2a,0x31c8,0x2145,0x18e3,
  0x3be9,0x37a9,0x3368,0x2f27,0x2ae7,0x26a6,0x2666,0x2225,0x1de4,0x19a4,0x1563,0x1123,0x0ce2,0x08a1,0x0461,0x0020,
  0x03e0,0x0360,0x02e0,0x0260,0x01e0,0x0160,0x00e0,0x00a0,0x5bdc,0x33d8,0x0bb5,0x0732,0x02af,0x022d,0x01aa,0x0147,
  0x67df,0x53bf,0x3b9f,0x2b3f,0x271f,0x22df,0x1a9f,0x0e1b,0x09b6,0x0950,0x04ca,0x0065,0x3b38,0x22b5,0x0a10,0x016b,
  0x739f,0x631f,0x56bf,0x463f,0x35bf,0x253f,0x14bf,0x085f,0x001f,0x001b,0x0017,0x0014,0x0012,0x000f,0x000c,0x0009,
  0x6adf,0x625f,0x559f,0x491f,0x3c5f,0x341c,0x2c18,0x2013,0x180d,0x1009,0x4a59,0x39d6,0x2954,0x1cef,0x14ab,0x1089,
  0x7f1f,0x7e9f,0x7e1f,0x7d9f,0x7d1f,0x7c1f,0x681a,0x5c17,0x4c13,0x380e,0x280a,0x1806,0x5f80,0x5300,0x4681,0x35e2,
  0x65f9,0x59b6,0x4d73,0x4130,0x34ed,0x28aa,0x1c67,0x1445,0x7efb,0x7e57,0x75b4,0x6951,0x60ee,0x54cc,0x4cab,0x4089,
  0x7f7a,0x7ef7,0x7e73,0x6e10,0x61ad,0x5d8c,0x594a,0x50e7,0x7f35,0x7ef3,0x7ed0,0x7a8e,0x766d,0x6e4c,0x6a0b,0x65ea,
  0x5dc9,0x55a8,0x51a8,0x4da7,0x4987,0x4566,0x4146,0x3d45,0x3925,0x3504,0x2d04,0x28e3,0x24c3,0x1ca2,0x18a2,0x1481,
  0x5e91,0x564f,0x4e0d,0x45ec,0x41aa,0x3d89,0x3968,0x3548,0x3147,0x2d26,0x2905,0x24e4,0x7f9d,0x0007,0x0003,0x03ff,
  0x7fff,0x77bd,0x739c,0x6f7b,0x6b5a,0x6739,0x6318,0x5ef7,0x5ad6,0x56b5,0x5294,0x4e73,0x4a52,0x4631,0x4210,0x3def,
  0x39ce,0x35ad,0x318c,0x2d6b,0x294a,0x2529,0x2108,0x1ce7,0x18c6,0x14a5,0x1084,0x0c63,0x0842,0x0421,0x0000,0x0000,
  0x7def,0x7d6b,0x7ce7,0x7c00,0x7400,0x6c00,0x6400,0x5c00,0x5400,0x4c00,0x4400,0x3c00,0x3400,0x2c00,0x2000,0x1800,
  0x7f57,0x7f12,0x7ece,0x7e8a,0x7e46,0x7e03,0x7dc0,0x7180,0x6960,0x6540,0x5d20,0x5900,0x4cc0,0x4080,0x3c60,0x3840,
  0x734a,0x6ac8,0x5e45,0x55c3,0x4962,0x4100,0x3880,0x2800,0x7fe9,0x7fe0,0x6f41,0x62c1,0x5241,0x41c1,0x3560,0x2900,
  0x7ff9,0x7ff5,0x7ff1,0x7fed,0x734f,0x66ef,0x5a8e,0x49eb,0x6bf4,0x6371,0x570f,0x4aad,0x3e2a,0x31c8,0x2145,0x18e3,
  0x3be9,0x37a9,0x3368,0x2f27,0x2ae7,0x26a6,0x2666,0x2225,0x1de4,0x19a4,0x1563,0x1123,0x0ce2,0x08a1,0x0461,0x0020,
  0x03e0,0x0360,0x02e0,0x0260,0x01e0,0x0160,0x00e0,0x00a0,0x5bdc,0x33d8,0x0bb5,0x0732,0x02af,0x022d,0x01aa,0x0147,
  0x67df,0x53bf,0x3b9f,0x2b3f,0x271f,0x22df,0x1a9f,0x0e1b,0x09b6,0x0950,0x04ca,0x0065,0x3b38,0x22b5,0x0a10,0x016b,
  0x739f,0x631f,0x56bf,0x463f,0x35bf,0x253f,0x14bf,0x085f,0x001f,0x001b,0x0017,0x0014,0x0012,0x000f,0x000c,0x0009,
  0x6adf,0x625f,0x559f,0x491f,0x3c5f,0x341c,0x2c18,0x2013,0x180d,0x1009,0x4a59,0x39d6,0x2954,0x1cef,0x14ab,0x1089,
  0x7f1f,0x7e9f,0x7e1f,0x7d9f,0x7d1f,0x7c1f,0x681a,0x5c17,0x4c13,0x380e,0x280a,0x1806,0x5f80,0x5300,0x4681,0x35e2,
  0x65f9,0x59b6,0x4d73,0x4130,0x34ed,0x28aa,0x1c67,0x1445,0x7efb,0x7e57,0x75b4,0x6951,0x60ee,0x54cc,0x4cab,0x4089,
  0x7f7a,0x7ef7,0x7e73,0x6e10,0x61ad,0x5d8c,0x594a,0x50e7,0x7f35,0x7ef3,0x7ed0,0x7a8e,0x766d,0x6e4c,0x6a0b,0x65ea,
  0x5dc9,0x55a8,0x51a8,0x4da7,0x4987,0x4566,0x4146,0x3d45,0x3925,0x3504,0x2d04,0x28e3,0x24c3,0x1ca2,0x18a2,0x1481,
  0x5e91,0x564f,0x4e0d,0x45ec,0x41aa,0x3d89,0x3968,0x3548,0x3147,0x2d26,0x2905,0x24e4,0x7f9d,0x0007,0x0003,0x03ff,
};

///////////////////////////////////////////////////////////////////////////////
// EOF
///////////////////////////////////////////////////////////////////////////////
